<html>
<head>
<TITLE><<YM2149></TITLE>
</head>

<body background="xgr.jpg" bgproperties="fixed">
<center><img src="flag.gif">
<font size="+2" color="Green"><b><a name='YANDEX_0'></a><font color=#ff0000><I><U><B>YM2149</font></B></U></I></b></font></center>
<hr>

<center><font size="+2"><b>Программно управляемый генератор звука (SSG)</b></font></center><br>

<center><font size="+2"><b>Обзор</b></font></center>
<p align="JUSTIFY">&nbsp;
SSG - (Software controlled Sound Generator) это большая интегральная
микросхема, выполненная по технологии NMOS и разработанная для генерации звуков.
От микропроцессора и микроконтроллера (CPU) требуется только инициализация
массива регистров, что уменьшает загрузку CPU. Генерация звука производиться
тремя генераторами прямоугольных волн, генератором шума и генератором огибающей.</p>

<center><font size="+2"><b>Характеристики</b></font></center><br>

<li>Одно напряжение питания 5 вольт.
<li>Лёгкое сопряжение с 8 и 16 битными процессорами.
<li>Лёгкое сопряжение с внешней системой через два восьмибитных порта ввода-вывода.
<li>Широкий диапазон голосов в восемь октав.
<li>Плавное затухание на 5 битном генераторе огибающей.
<li>Встроенный 5 битный цифро-аналоговый преобразователь.
<li>Удвоенная частота, поданная на тактовый вход, может быть поделена встроенным делителем.
<li>TTL совместимые уровни сигналов.
<li>Низкое потребление (125 мвт).
<li>40 штырьковый пластмассовый DIL корпус.
<li>Совместимость по ножкам с AY-3-8910 производства General Instruments.

<br><br><center><font size="+1">Распиновка</font></center>
<center><img src="ym_01.gif" alt="Распиновка" border=0 width=481 height=379></center>

<br><center><font size="+1">Блок схема</font></center>
<center><img src="ym_02.gif" alt="Блок схема" border=0 width=635 height=486></center>

<br><br><center><font size="+2">Описание выводов</font></center>

<dl><dt><b><li>DA7~DA0</b><dd><p align="JUSTIFY">&nbsp;
Восьмибитная двунаправленная шина данных, используется для передачи данных и адресов между
SSG и CPU. В режимах чтения и записи DA7~DA0 обмениваются байтами с массивом регистров R7~R0.
В адресном режиме DA3~DA0 адресует регистры, а DA7~DA4 используются вместе
с |A9 и A8 для старших адресов.</p></dl>

<dl><dt><b><li>A8 и |A9</b><dd><p align="JUSTIFY">&nbsp;
Линии старших адресов. A8 подтянут резистором к высокому потенциалу, а |A9 к низкому.
Если эти выводы не используются, необходимо подать на A8 +5 вольт, на |A9 - общий.</p></dl>

<dl><dt><b><li>|RESET</b><dd><p align="JUSTIFY">&nbsp;
Активный уровень напряжения - низкий. Устанавливает содержимое всех регистров в "0".
Этот вывод подтянут резистором к высокому потенциалу.</p></dl>

<dl><dt><b><li>CLOCK</b><dd><p align="JUSTIFY">&nbsp;
Вход тактовых импульсов на генераторы звука и огибающей.
Оснащён делителем частоты с коэффициентом деления 2, который позволяет использовать
для тактирования частоту в два раза меньшую, чем та, что подается на вход.</p></dl>

<dl><dt><b><li>|SEL</b><dd><p align="JUSTIFY">&nbsp;
Когда на |SEL подан высокий уровень, входная частота принимается как есть.
При низком уровне на |SEL, тактовая частота получается делением на два входящей частоты.
Этот вывод подтянут резистором к высокому потенциалу для сохранения совместимости по выводам с
AY-3-8910 производства General Instruments, когда этот вывод ни к чему не подключен.</p></dl>

<dl><dt><b><li>BDIR, BC1, BC2</b><dd><p align="JUSTIFY">&nbsp;
Управляют внешней (DA7~DA0) и внутренней шиной SSG. Контроллер шины может находиться
в одном из четырёх состояний. Управление избыточно и BC2 может быть подключен к +5V.

<br><table border=1 align="center" cellpadding=3 Cellspacing=0 bgcolor="white">
<caption align="bottom">Дешифрация BDIR, BC1, BC2.</caption>
<tr align="center"><td>BDIR<td>BC2<td>BC1<td>Режим
<tr align="center"><td>0<td>0<td>0<td>Неактивный
<tr align="center"><td>0<td>0<td>1<td>Адресный
<tr align="center"><td>0<td>1<td>0<td>Неактивный
<tr align="center"><td>0<td>1<td>1<td>Чтение
<tr align="center"><td>1<td>0<td>0<td>Адресный
<tr align="center"><td>1<td>0<td>1<td>Неактивный
<tr align="center"><td>1<td>1<td>0<td>Запись
<tr align="center"><td>1<td>1<td>1<td>Адресный
</table><br>

<b>Неактивный режим:</b> DA7~DA0 в высокоимпедансном состоянии.<br>
<b>Адресный режим:</b> с DA7~DA0 снимается адрес (номер) регистра и устанавливается как текущий.<br>
<b>Режим записи:</b> данные с DA7~DA0 записываются в текущий регистр.<br>
<b>Режим чтения:</b> содержимое текущего регистра выводится на DA7~DA0.</p></dl>

<dl><dt><b><li>ANALOG CHANNEL A, B, C</b><dd><p align="JUSTIFY">&nbsp;
Каждый канал имеет цифро-аналоговый преобразователь, преобразующий цифровые величины в
аналоговые сигналы.</p></dl>

<dl><dt><b><li>IOA7~IOA0, IOB7~IOB0</b><dd><p align="JUSTIFY">&nbsp;
Это два восьмибитных порта ввода/вывода. Наличие портов позволяет поместить
SSG между внешней системой и центральным процессором для передачи данных.
Выводы подтянуты резисторами к высокому потенциалу.</p></dl>

<dl><dt><b><li>TEST1</b><dd> Вывод для тестирования устройства. Никуда не подключен.</dl>

<dl><dt><b><li>V<sub>cc</sub></b><dd> Вывод питания +5V.</dl>

<dl><dt><b><li>V<sub>ss</sub></b><dd> Вывод земли.</dl>

<center><font size="+2"><b>Расшифровка функций</b></font></center>
<p align="JUSTIFY">&nbsp;Все функции SSG контролируются 16 внутренними регистрами.
Центральный процессор должен только записывать данные в эти регистры, а SSG
самостоятельно генерирует звук. Генерация звука производиться следующими модулями:<br>
<li><b>Генератор тона (Music generator):</b> генерирует квадратные колебания различной частоты отдельно для каждого канала (A, B и C).
<li><b>Генератор шума (Noise generator):</b> генерирует псевдослучайный сигнал переменной частоты.
<li><b>Смеситель (Mixer):</b> смешивает выходы тона и шума раздельно по трем каналам (A, B и C).
<li><b>Регулятор громкости (Level control):</b> задает постоянный или переменный уровень громкости
для каждого из трех каналов (A, B и C). Постоянный уровень устанавливается центральным процессором,
а переменный - генератором огибающей.
<li><b>Генератор огибающей (Envelope generator):</b> формирует различные типы затухания (единичное
и повторяющиеся затухания).
<li><b>Цифро-аналоговый преобразователь (D/A convertor):</b> звук формируется изменением
уровня сигнала на каждом из трех каналов (A, B и C).
</p>
Центральный процессор может читать содержимое внутренних регистров, не внося изменений в генерируемый звук.

<p><font size="+2"><b>Массив регистров</b></font></p>
<center><img src="ym_03.gif" alt="Массив регистров" border=0 width=445 height=143></center><br>

<p align="JUSTIFY">&nbsp;
В десяти битном адресе младшие адреса DA3~DA0 используются для выбора 16 внутренних регистров
из массива регистров. Старшие адреса |A9, A8 и DA7~DA4 используются для выбора кристалла.
В случае, когда на них присутствует комбинация отличная от 010000b
двунаправленные буферы переводятся в высокоимпедансное состояние.
<br><br>
Структура массива регистров (номера регистров представлены в шестнадцатиричной системе).
<br>
<center><img src="ym_04.gif" alt="Структура массива регистров" border=0 width=605 height=440></center><br>

<br>
<dl><dt><b><li>Частота тона (задается регистрами R0~R5)</b><dd><p align="JUSTIFY">&nbsp;
Частота прямоугольных импульсов производимых генераторами тона трех каналов (A, B и C)
задается регистрами с R0 по R5. R0 и R1 управляют каналом A, R2 и R3 используются для
канала B, R4 и R5 для канала C.
Частота колебаний осциллятора <i>f</i><sub>T</sub> получается следующим образом из значения
регистра TP:
<center><i>f</i><sub>T</sub> = <sup><i>f</i><sub>Master</sub></sup><sub><font size="+3">/</font>(16 TP)</sub>,</center>
где <i>f</i><sub>Master</sub> - тактовая частота, равная входящей частоте при высоком уровне на |SEL и
<sup>1</sup><sub><font size="+3">/</font>2</sub> входящей частоты при низком уровне.</p></dl>

<center><img src="ym_05.gif" alt="Структура регистров, задающих частоту тона" border=0 width=609 height=225></center><br>

<dl><dt><b><li>Частота шума (задается регистром R6)</b><dd><p align="JUSTIFY">&nbsp;
Частота шума f<sub>N</sub> определяется регистром NP по следующей формуле:
<center><i>f</i><sub>N</sub> = <sup><i>f</i><sub>Master</sub></sup><sub><font size="+3">/</font>(16 NP)</sub>.</center>
<center><img src="ym_06.gif" alt="Структура регистра R6, задающего частоту шума" border=0 width=333 height=155></center><br>
</p></dl>

<dl><dt><b><li>Установки смесителя и портов ввода/вывода (задается регистром R7)</b><dd><p align="JUSTIFY">&nbsp;
Смеситель используется для комбинирования компонентов тона и шума.
Различные комбинации определяются битами B5~B0 регистра R7.
Звук выводиться, когда в регистре содержится "0".
Таким образом, когда биты соответствующие тону и шуму установлены в "0" смеситель смешивает
их на выходе. Когда шуму соответствует "0" и тону "1", выводиться только шум и наоборот.
Если все биты, отвечающие за тон и шум, установлены в "1" звук не воспроизводиться.
Выбор режима портов ввода/вывода определяется битами B7 и B6 регистра R7.
Порт настраиваются на ввод когда в соответствующий бит, записан "0", иначе на вывод.

<center><img src="ym_07.gif" alt="Структура регистра R6, задающего частоту шума" border=0 width=390 height=159></center><br>
</p></dl>

<dl><dt><b><li>Уровень громкости (задается регистром R8~RA)</b><dd><p align="JUSTIFY">&nbsp;
Громкость звука на выходе ЦАП для трех каналов (A, B и C) регулируется регистрами R8, R9 и RA.</p>

<center><img src="ym_08.gif" alt="Структура регистров управления уровнем громкости" border=0 width=351 height=221></center><br>

<p align="JUSTIFY">
Режим M определяет, будет ли уровень громкости фиксированый (при M="0") или переменным (при M="1").
Когда M="0", уровень громкости устанавливается в одно из 16 значений и определяется
битами L3, L2, L1 и L0. Когда M="1" уровень громкости определяется пятью битами
E4, E3, E2, E1 и E0 генератора огибающей.
</p></dl>

<dl><dt><b><li>Частота огибающей (задается регистрами RB и RC)</b><dd><p align="JUSTIFY">&nbsp;
Частота повторения огибающей <i>f</i><sub>E</sub> определяется периодом огибающей EP:
<center><i>f</i><sub>E</sub> = <sup><i>f</i><sub>Master</sub></sup><sub><font size="+3">/</font>(256 EP)</sub>.</center></p>

<center><img src="ym_09.gif" alt="Структура регистров управления периодом огибающей" border=0 width=401 height=181></center><br>

<p align="JUSTIFY">
Фактический период огибающей <sup>1</sup><sub><font size="+3">/</font><i>f</i><sub>EA</sub></sub>
есть <sup>1</sup><sub><font size="+3">/</font>32</sub>
периода <sup>1</sup><sub><font size="+3">/</font><i>f</i><sub>E</sub></sub>
<i>(На сколько я понимаю, f<sub>EA</sub> используется для формирования огибающей посредством
пятиразрядного ЦАП, следовательно плавное возрастание/убывание сигнала происходит за
<sup>1</sup><sub><font size="+3">/</font>f<sub>E</sub></sub>, т. е. за 32 такта
f<sub>EA</sub>. В <a href="zv.htm#lit">[1]</a> информация по звуковому генератору вообще
скудная и неверная, что, кстати, привело к ошибке в процедуре выключения звука "музыкального звонка",
а в <a href="zv.htm#lit">[2]</a> по этому поводу сказано следующее:
"Генератор формы огибающей путем деления частоты огибающей на 16 образует и выдает на регулятор
амплитуды форму огибающей, представленную шестнадцатью фиксированными уровнями напряжений
на один цикл, закодированными в четырехразрядном выходном счетчике", что также противоречит
данному документу - примечание переводчика)</i>.</p></dl>

<dl><dt><b><li>Форма огибающей (задается регистром RD)</b><dd><p align="JUSTIFY">&nbsp;
Счетчик генератора огибающей синхронизируется частотой огибающей <i>f</i><sub>EA</sub>
32 раза за период огибающей.
Уровень огибающей определяется пятью битами (E4~E0) счётчика огибающей.
Форма огибающей создается увеличением, уменьшением, высоким или низким уровнем и повторением
этого счетчика. Форма огибающей управляется битами B3~B0 регистра RD
<i>(Вероятно под "счетчиком" понимается пяти разрядный счетчик входящий в генератор огибающей,
который управляет ЦАПом и могущий работать как на возрастание так и на убывание в зависимости
от установок регистра RD. Тактируется он частотой <i>f</i><sub>EA</sub> и переполняется за время
<sup>1</sup><sub><font size="+3">/</font><i>f</i><sub>E</sub></sub> - примечание переводчика).</i></p>
<center><img src="ym_10.gif" alt="Структура регистра RD управления формой огибающей" border=0 width=315 height=131></center><br>
<p align="JUSTIFY">В зависимости от сигналов CONT, ATT, ALT и HOLD огибающая может принимать
формы, представленные в следующей таблице.</p></dl>
<center><img src="ym_11.gif" alt="Варианты формы огибающей" border=0 width=608 height=299></center><br>

<dl><dt><b><li>Данные портов ввода/вывода (регистры RE и RF)</b><dd><p align="JUSTIFY">&nbsp;
Регистры RE и RF используются для хранения содержимого портов ввода/вывода.
RE отождествлен с IOA и RF с IOB.</p></dl>


<p><font size="+2"><b>ЦАП</b></font></p><p align="JUSTIFY">&nbsp;
ЦАП устройства имеет логарифмическую шкалу 0 - 1В, т. е. фактически регулирует громкость звука,
что обеспечивает широкий динамический диапазон выходного сигнала.
</p>

<center><font size="+2"><b>Электрические характеристики</b></font></center><br>

<dl><dt><b><li>Максимально допустимые значения параметров</b><dd><p></p>
<table border=1 align="center" Cellpadding=3 Cellspacing=0 bgcolor="white">
<tr align="center"><th>Параметр<th>Диапазон<th>Еденица измерения
<tr align="center"><td>
Напряжение на выводах<br><br>
Диапазон рабочих температур<br><br>
Температура хранения<td>
-0,3 ~ +7,0<br><br>
0 ~ 70<br><br>
-50 ~ 125<td>
Вольт<br><br>
°C<br><br>
°C
</table></dl>

<dl><dt><b><li>Рекомендуемые значения параметров</b><dd><p></p>
<table border=1 align="center" cellpadding=3 Cellspacing=0 bgcolor="white">
<tr align="center"><th>Параметр<th>Символ обозначения<th>Мин.<th>Ср.<th>Макс.<th>Еденица измерения
<tr align="center"><td>
Напряжение питания<td>
V<sub>cc</sub><br><br>
V<sub>ss</sub><td>
4,75<br><br>
0<td>
5<br><br>
0<td>
5,25<br><br>
0<td>
Вольт<br><br>
Вольт
</table></dl>

<hr>
<font color="Olive">Продолжение не последует. Это конец.</font>

</body>
</html>
