<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<title>AY Sound FX Editor Help</title>
<style>
#txt{font-family: Arial,sans-serif;font-size:12px;color:#000000;}
#txg{font-family: Arial,sans-serif;font-size:12px;color:#505050;}
#zag{font-family: Arial,sans-serif;font-size:30px;color:#FFFFFF;}
.lfx a:hover{color:#FF0000;}
.lfx a{text-decoration:none;}
</style>
</head>

<body bgcolor=#FFFFFF text=#000000 link=#0000AF vlink=#0000AF alink=#0000AF>
<table width=100% bgcolor=#0000FF><tr><td id=zag><b>AY Sound FX Editor v0.4</b></td></tr></table>

<br><br>

<a name=conte><b id=txg>Содержание</b></a><br><br>
<blockquote id=txt class=lfx>
<a href=#intro>Описание</a><br>
<a href=#iface>Интерфейс</a><br>
<a href=#hotke>Горячие клавиши</a><br>
<a href=#impor>Импорт эффектов</a><br>
<a href=#forma>Форматы файлов</a><br>
<a href=#playe>Плеер для ZX Spectrum</a><br>
<a href=#histo>История версий</a><br>
<a href=#thank>Благодарности</a><br>
<a href=#conta>Контакты</a><br>
</blockquote>
<br><br>


<p id=txt class=lfx><a href=#conte title="К содержанию"><b>^</b></a> <a name=intro><b>Описание</b></a></p>
<p id=txt class=lfx>
AY Sound FX Editor представляет собой комплексное решение для создания звуковых эффектов для чипа AY-3-8910. Подобные эффекты могут использоваться в играх и других программах на ZX Spectrum. Возможно использование и на других микрокомпьютерах, использующих AY-3-8910. В состав пакета входят: собственно кросс-редактор звуковых эффектов (программа для PC под ОС Windows), пример простого плеера на ассемблере Z80 в исходниках, скомпилированный пример использования плеера и библиотека готовых звуковых эффектов.
<br><br>
Редактор позволяет создавать одноканальные эффекты, длиной до 4096 фреймов на эффект. Фрейм - это 1/50 секунды, соответственно, максимальная продолжительность звучания эффекта - около 80 секунд. Для каждого фрейма задаются значения регистров тона/шума/микшера. Огибающая не используется. Данные сохраняются в компактном формате, без повторения одинаковых значений. Эффекты собираются в банки, до 256 эффектов. Плеер эффектов работает с банком, нужный эффект вызывается по его номеру в банке.
<br><br>
Нужно отметить, что редактор не может содавать эффекты за Вас, он только упрощает редактирование данных для регистров AY. Способ создания эффектов в редакторе похож на создание сэмплов в музыкальных редакторах для AY. Поэтому для создания эффектов требуется понимание общих принципов работы AY, понимание способов получения требуемого результата. Однако, редактор имеет средства импорта из различных форматов, что может упростить создание эффектов.
</p><br><br>

<p id=txt class=lfx><a href=#conte title="К содержанию"><b>^</b></a> <a name=iface><b>Интерфейс</b></a></p>
<p id=txt class=lfx>
Интерфейс редактора англоязычный. В верхней части окна редактора находится главное меню. Назначение пунктов меню:
</p>
<blockquote id=txt class=lfx>
File
<blockquote id=txt class=lfx>
New bank - Очистка банка эффектов, создаётся один пустой эффект (текущий);<br>
Load bank - Загрузка банка эффектов из файла;<br>
Save bank - Сохранение банка эффектов в файл;<br>
Save bank w/o names - Сохранение банка эффектов в файл, без названий эффектов;<br><br>
Clear current effect - Очистить текущий эффект;<br>
Load current effect - Загрузить текущий эффект из файла одиночного эффекта;<br>
Save current effect - Сохранить текущий эффект в файл;<br><br>
Multi-load to bank - Загрузить несколько эффектов из файлов, в конец банка, начиная с последнего пустого эффекта;<br>
Multi-save from bank - Сохранить все эффекты из банка в отдельные файлы, имена берутся из имён эффектов в банке (эффекты сохранятся в указанную для первого из них папку);<br><br>
Exit - Выход из программы.<br>
</blockquote>
Edit
<blockquote id=txt class=lfx>
Cut - Удалить из эффекта выделенные строки и поместить их в буфер обмена. Для этого и последующих действий в случае отсутствия выделения берётся текущая строка (с курсором);<br>
Copy - Скопировать выделенные строки в буфер обмена (выделение снимается);<br>
Paste - Вставить содержимое буфера обмена в позицию курсора, текущая и последующие строки будут сдвинуты вниз;<br>
Delete - Удалить выделенные строки;<br><br>
Select all - Выделить все активные строки эффекта;<br>
Unselect all - Снять выделение со всех строк;<br>
Inverse selection - Инвертировать выделение.<br>
</blockquote>
View
<blockquote id=txt class=lfx>
Piano input - Показать/спрятать окно ввода музыкальных тонов (см. <a href=#piano>далее</a>);<br>
Linear period - Отображение значения тона в линейной шкале (неравномерное распределение частот);<br>
Logarithmic period - Отображение значения тона в логарифмической шкале.<br>
</blockquote>
Bank
<blockquote id=txt class=lfx>
Add new effect - Добавить новый эффект в конец банка. Новый эффект становится текущим;<br>
Delete effect - Удалить текущий эффект из банка;<br>
Insert new effect - Вставить новый эффект в банк вместо текущего; текущий и последующие сдвигаются.<br>
</blockquote>
Import (см. раздел <a href=#impor>Импорт эффектов</a>)
<blockquote id=txt class=lfx>
PSG for AY - Импорт из PSG-файла;<br>
VTX file - Импорт из VTX-файла;<br>
Wave file - Импорт из WAV-файла.<br>
</blockquote>
</blockquote>
<p id=txt class=lfx>
<br>
Под главным меню находится строка c несколькими элементами управления. При наведении на них стрелки мыши выводится подсказка об их назначении.<br><br>
В левой части строки находится группа из трёх кнопок. Кнопки с символами Play и Stop выполняют соответствующие действия с текущим эффектом. Кнопка с клавишами пианино показывает/убирает с экрана окно ввода музыкальных тонов (см. <a href=#piano>далее</a>).<br><br>
В правой части строки находятся кнопки управления банком эффектов. Кнопка [Add] добавляет эффект в конец банка. Кнопка [Del] удаляет текущий эффект. Следующие четыре кнопки, между которыми находится индикатор номера текущего эффекта и их общего количества, переключают текущий эффект. Двойные стрелки - переход к первому и последнему эффекту в банке, одинарные - к предыдущему и следующему. Последним в строке располагается поле с именем текущего эффекта. Для ввода имени нужно кликнуть левой кнопкой мыши на поле с названием. Завершение ввода имени происходит по Enter. В процессе редактирования имени все нажатия кнопок направляются полю ввода, поэтому часть горячих клавиш в этот момент не действует.
<br><br><br>
Всю остальную часть окна занимает поле редактирования текущего эффекта. Редактирование значений может производиться как с помощью мыши, так и вводом значений с клавиатуры. Поле редактирования разделено на несколько колонок. Pos - номер строки. Строки можно выделять кликом левой клавишей мыши на номере; снимается выделение правой клавишей мыши. T, N - значение микшера. Изменяется аналогично выделению. Per - значение периода, то-есть высоты тона. Ns - значение частоты шума. V - значение громкости. При клике любой кнопкой мыши на значениях Per,Ns,V происходит переход курсора в эту позицию. Остальную часть поля редактирования занимает графическое отображение значений периода, частоты шума, и громкости. Кликом любой клавиши мыши можно изменять эти значения.
<br><br>
Окно редактора может изменять размер по вертикали (с дискретностью в строку), размер по горизонтали не меняется.
<br><br><br>
<a name=piano>Для</a> создания эффектов, использующих музыкальные тона в редакторе есть специальное окно. Оно вызывается нажатием клавиши с изображением клавиш пианино или через главное меню View->Piano Input. В левой части окна располагается подсказка, каким клавишам на клавиатуре соответствуют ноты октавы. В правой части - ряд контролов с настройками ввода. В поле Octave указывается текущая октава (1...8). Поле Step - шаг смещения курсора после ввода ноты, в фреймах. Поле Fill - шаг заполнения, т.е. сколько строк подряд будет заполнено одним нажатием. Кнопка Link связывает поля Step и Fill, делая шаг заполнения равным шагу перемещения курсора. Нажатая кнопка Set T устанавливает флаг тона во вводимых строках, отжатая - не меняет ранее установленный. Нажатая кнопка Set volume устанавливает для вводимых строк значение из поля громкости (справа от кнопки), отжатая - не изменяет ранее установленную.
</p><br><br>


<p id=txt class=lfx><a href=#conte title="К содержанию"><b>^</b></a> <a name=hotke><b>Горячие клавиши</b></a></p>
<p id=txt class=lfx>
<i>Главное окно</i><br><br>
<table border=0 cellspacing=2 cellpadding=1>
<tr valign=top><td width=180 bgcolor=#d0d0d0>Cursor Up/Down</td><td bgcolor=#f5f5f5>Переход к верхней/нижней строке.</td></tr>
<tr valign=top><td bgcolor=#d0d0d0>Cursor Left/Right</td><td bgcolor=#f5f5f5>Переход между колонками тон/шум/громкость.</td></tr>
<tr valign=top><td bgcolor=#d0d0d0>0-9, A-F</td><td bgcolor=#f5f5f5>Ввод значений тона/шума/громкости.</td></tr>
<tr valign=top><td bgcolor=#d0d0d0>Page Up/Down</td><td bgcolor=#f5f5f5>Переход на экран вверх/вниз.</td></tr>
<tr valign=top><td bgcolor=#d0d0d0>Колесо мыши</td><td bgcolor=#f5f5f5>Переход на пять строк вверх-вниз.</td></tr>
<tr valign=top><td bgcolor=#d0d0d0>Home</td><td bgcolor=#f5f5f5>Переход на начало эффекта (нулевая позиция).</td></tr>
<tr valign=top><td bgcolor=#d0d0d0>End</td><td bgcolor=#f5f5f5>Переход на конец эффекта (последнее ненулевое значение громкости).</td></tr>
<tr valign=top><td bgcolor=#d0d0d0>Клик мыши</td><td bgcolor=#f5f5f5>На линейках тона/шума/громкости - изменение их значений; на имени эффекта - переход в режим редактирования имени.</td></tr>
<tr valign=top><td bgcolor=#d0d0d0>Левая кнопка мыши</td><td bgcolor=#f5f5f5>На флагах T/N - установка флага; на номере строки - выделение строки.</td></tr>
<tr valign=top><td bgcolor=#d0d0d0>Правая кнопка мыши</td><td bgcolor=#f5f5f5>На флагах T/N - сброс флага; на номере строки - сброс выделения.</td></tr>
<tr valign=top><td bgcolor=#d0d0d0>Enter</td><td bgcolor=#f5f5f5>В режиме редактирования эффекта - проигрывание эффекта; в режиме ввода имени эффекта - переход в режим редактирования эффекта.</td></tr>
<tr valign=top><td bgcolor=#d0d0d0>Ctrl+Enter</td><td bgcolor=#f5f5f5>Проигрывание эффекта с текущей строки.</td></tr>
<tr valign=top><td bgcolor=#d0d0d0>Пробел</td><td bgcolor=#f5f5f5>Прекращение проигрывания эффекта.</td></tr>
<tr valign=top><td bgcolor=#d0d0d0>Delete</td><td bgcolor=#f5f5f5>Удаление выделенного блока (выделенные строки уберутся, остальные сдвинутся). если нет выделенных строк, удаляется текущая.</td></tr>
<tr valign=top><td bgcolor=#d0d0d0>Insert</td><td bgcolor=#f5f5f5>Вставка пустой строки (текущая и последующие строки сдвигаются вниз).</td></tr>
<tr valign=top><td bgcolor=#d0d0d0>Shift+Insert</td><td bgcolor=#f5f5f5>Дублирование текущей строки (последующие строки сдвигаются вниз).</td></tr>
<tr valign=top><td bgcolor=#d0d0d0>T</td><td bgcolor=#f5f5f5>Переключает флаг T на текущей строке.</td></tr>
<tr valign=top><td bgcolor=#d0d0d0>N</td><td bgcolor=#f5f5f5>Переключает флаг N на текущей строке.</td></tr>
<tr valign=top><td bgcolor=#d0d0d0>Ctrl+A</td><td bgcolor=#f5f5f5>Выделяет всю активную часть эффекта (до последней ненулевой громкости).</td></tr>
<tr valign=top><td bgcolor=#d0d0d0>Ctrl+I</td><td bgcolor=#f5f5f5>Инвертирует выделение активной части эффекта.</td></tr>
<tr valign=top><td bgcolor=#d0d0d0>Ctrl+X</td><td bgcolor=#f5f5f5>Перенести выделенные строки в буфер обмена, удалив их из эффекта.</td></tr>
<tr valign=top><td bgcolor=#d0d0d0>Ctrl+C</td><td bgcolor=#f5f5f5>Скопировать выделенные строки в буфер обмена (выделение снимается).</td></tr>
<tr valign=top><td bgcolor=#d0d0d0>Ctrl+V</td><td bgcolor=#f5f5f5>Вставить содержимое буфера обмена в позицию курсора, текущая и последующие строки будут сдвинуты вниз.</td></tr>
<tr valign=top><td bgcolor=#d0d0d0>Numpad [+]</td><td bgcolor=#f5f5f5>Переход к следующему эффекту в банке.</td></tr>
<tr valign=top><td bgcolor=#d0d0d0>Numpad [-]</td><td bgcolor=#f5f5f5>Переход к предыдущему эффекту в банке.</td></tr>
</table>
<br><br>
<i>Окно ввода нот</i><br><br>
<table border=0 cellspacing=2 cellpadding=1>
<tr valign=top><td width=180 bgcolor=#d0d0d0>Z,S,X,D,C,V,G,B,H,N,J,M</td><td bgcolor=#f5f5f5>Ввод нот До..Си текущей октавы.</td></tr>
<tr valign=top><td bgcolor=#d0d0d0>Shift+клавиша ноты</td><td bgcolor=#f5f5f5>Ввод ноты с октавой на одну выше текущей.</td></tr>
<tr valign=top><td bgcolor=#d0d0d0>Ctrl+клавиша ноты</td><td bgcolor=#f5f5f5>Ввод ноты с октавой на одну ниже текущей.</td></tr>
<tr valign=top><td bgcolor=#d0d0d0>Numpad 1...8</td><td bgcolor=#f5f5f5>Выбор текущей октавы.</td></tr>
</table>
</p><br><br>


<p id=txt class=lfx><a href=#conte title="К содержанию"><b>^</b></a> <a name=impor><b>Импорт эффектов</b></a></p>
<p id=txt class=lfx>
Поддерживаются следующие форматы.
<br><br>
<i>WAV</i>
<br><br>
Аудиофайлы. Поддерживаются любые стандартные PCM-файлы (любая разрядность, частота дискретизации, mono/stereo). На текущий момент импортируется только громкостная огибающая. Значения тона и шума устанавливаются в нули, флаги T/N установлены.
<br><br>
<i>PSG</i>
<br><br>
Дамп регистров AY. Поддерживаются файлы с полным заголовком (16 байт). Такие файлы создают AY-Emulator и Z80Stealth. Перед импортом появляется диалог выбора канала, с которого будут браться данные. Auto выбирает тот канал, на котором первым происходит изменение громкости. Импортируется тон, громкость, и установки микшера выбранного канала, а также значение регистра шума. Для облегчения импорта файл должен содержать одиночные одноканальные эффекты. При auto-выборе канала пауза в начале файла, до начала реальных выводов в порты, пропускается автоматически.
<br><br>
<i>VTX</i>
<br><br>
Дамп регистров AY. Такие файлы создают AY-Emulator и UnrealSpeccy. Импорт происходит аналогично PSG.
</p><br><br>


<p id=txt class=lfx><a href=#conte title="К содержанию"><b>^</b></a> <a name=forma><b>Форматы файлов</b></a></p>
<p id=txt class=lfx>
Порядок байт в двухбайтных числах - младший/старший.<br><br>
<i>Формат одиночного эффекта, расширение .afx</i>
<br><br>
Каждое прерывание кодируется последовательностью байт, их количество может изменяться в зависимости от изменений значений тона/шума/громкости в текущем прерывании. Сначала идёт информационный байт:
</p>
<pre>
 bit0..3  Громкость
 bit4     Запрещение T
 bit5     Изменение T
 bit6     Изменение N
 bit7     Запрещение N
</pre>
<p id=txt class=lfx>
Если установлен bit5, далее следуют два байта со значением тона; если установлен bit6 - байт со значением шума; если установлены оба этих бита - сначала идёт значение тона, потом шума; если не установлен ни один - сразу идёт следующий информационный байт.
<br><br>
Конец эффекта помечается последовательностью байт #D0,#20. Плеер должен определять её до вывода в регистры (сравнением значения шума на = #20). В редакторе за признак конца эффекта считается последнее ненулевое значение громкости, вне зависимости от остальных параметров.
<br><br>

<i>Формат банка эффектов, расширение .afb</i>
<br><br>
Заголовок:
<br><br>
+0 (1 байт) Количество эффектов в банке (максимум 256 эффектов, значение 0 = 256);<br>
+1 (2 байта на эффект) Таблица смещений до начала каждого из эффектов. Смещение указывается относительно второго байта самого смещения. Такой формат смещения позволяет быстро вычислять адрес эффекта:
<br><br>
</p>
<pre>
   hl=адрес в таблице смещений
   ld c,(hl)
   inc hl
   ld b,(hl)
   add hl,bc
   hl=адрес эффекта
</pre>
<p id=txt class=lfx>
Данные:
<br><br>
+n (m байт) Сами эффекты в формате одиночного эффекта. После каждого эффекта может идти строка с его названием, оканчивается нулевым байтом. Строка может отсутствовать (при сохранении через соответствующий пункт в меню File), в этом случае нулевой байт также отсутствует.
</p><br><br>

<p id=txt class=lfx><a href=#conte title="К содержанию"><b>^</b></a> <a name=playe><b>Плеер для ZX Spectrum</b></a></p>
<p id=txt class=lfx>
В состав пакета входит простейший плеер эффектов. Он находится в папке /z80player/, файл ayfxplay.a80, в виде исходника для кросс-ассемблера asm80. Файлы .a80 представляют собой текстовый файл, их можно просмотреть любым текстовым редактором. Исходник снабжён комментариями по использованию и работе плеера.
<br><br>
Плеер проигрывает эффекты на всех трёх каналах AY. При наличии свободного (незвучащего) канала выбирается этот канал, иначе - тот, который звучал дольше всего. Проигрывание музыки при работе плеера эффектов невозможно.
<br><br>
Помимо плеера прилагается исходник тестовой программы, и сама программа в собранном виде, в SCL-файле. Все клавиши вызывают различные эффекты, кроме клавиши пробела. Последняя включает/выключает музыку, проигрываемую на втором AY-чипе TurboSound'а по схеме NedoPC (если он есть). Если TS отсутствует, музыка будет проигрываться на том же чипе, что и эффекты, это приведёт к различным звуковым артефактам.
</p>
<br><br>

<p id=txt class=lfx><a href=#conte title="К содержанию"><b>^</b></a> <a name=histo><b>История версий</b></a></p>
<p id=txt class=lfx>
v0.4 09.05.06
<br><br>
- Полностью убрана возможность выбора частоты прерываний<br>
* Изменён формат эффектов и банков<br>
* Ряд оптимизаций z80-плеера по размеру и скорости (в т.ч. по советам AlCo)<br>
* Исправлены критические ошибки в импорте из VTX и PSG<br>
+ Запрещение кнопок переключения эффектов, если переключение невозможно<br>
+ Запрет на сохранение пустого эффекта<br>
+ Сохранение всех эффектов из банка в отдельные файлы<br>
+ Кнопки перехода на первый и последний эффекты в банке<br>
+ Дублирование текущей строки по Shift+Insert<br>
+ Окно ввода музыкальных тонов<br>
- Вводить ноты мышью пока нельзя<br>
+ Добавлено 14 эффектов в библиотеку<br>
* Обновлена документация<br>
<br>

v0.3 28.02.06
<br><br>
* Версия для пред-релизного тестирования, реализованы все основные возможности редактора<br>
+ Операции копирования блоков через буфер обмена (cut, copy, paste)<br>
* Исправлены ошибки в импорте из PSG<br>
+ Добавлен импорт из VTX-файлов (thx to SMT)<br>
* Убрана сильная нелинейность в начале логарифмической шкалы отображения тона (thx to AlCo)<br>
+ Компенсация резких перемещений мыши, для избежания пропусков строк<br>
+ Собирание эффектов в банки<br>
+ Автозагрузка сразу нескольких эффектов с добавлением их в банк<br>
+ Написан простейший плеер эффектов для Spectrum и пример его использования (исходники для asm80, с подробными комментариями)<br>
+ Собрана библиотека из 205 эффектов, в основном взятых из различных игр и серии музыкальных демо 'MSX'<br>
+ Подготовлена документация<br>
* Прочие небольшие изменения<br>
<br>

v0.2 12.02.06
<br><br>
* Исправлены проблемы с отображением в разных схемах оформления Windows (цвета, размеры, dpi)<br>
* Флаги T/N теперь устанавливаются левой кнопкой мыши, сбрасываются правой (вместо toggle)<br>
* Выделение строк теперь происходит  при нажатии левой кнопки мыши (убирается правой) в столбце номера позиции<br>
* Установка значений в линейках тона/шума/громкости теперь происходит любой кнопкой мыши<br>
+ При выделении строк и редактировании линеек мышью происходит удержание её в пределах столбца (предотвращает выход курсора мыши за пределы редактируемого поля)<br>
* Убрана перерисовка поля редактирования при удержании клавиши мыши на линейках тона/шума/громкости<br>
+ Незвучащая часть эффекта (после последней ненулевой громкости) отрисовывается светло-серым цветом<br>
+ Ввод значений тона/шума/громкости с клавиатуры (клавиши 0-9,A-F)<br>
* Эффект теперь проигрывается по Enter (Space останавливает проигрывание)<br>
+ Проигрывание эффекта с текущей строки по Ctrl+Enter<br>
+ Добавлен импорт из PSG-файлов (дамп регистров AY, создаётся различными эмуляторами)<br>
* Исправлено удаление строк<br>
+ Добавлен режим логарифмического отображения/редактирования тона (с переключением на линейный)<br>
* Изменён формат эффекта (код конечного маркера)<br>
+ Вставка пустой строки в текущую позицию по Insert (со сдвигом текущей и последующих вниз)<br>
+ Удаление текущей строки (если нет выделенных) по Delete (со сдвигом последующих вверх)<br>
+ Несколько новых горячих клавиш<br>
* Прочие мелкие исправления и дополнения<br>
<br>

v0.1 02.02.06
<br><br>
+ Первая версия для закрытого тестирования, написана за 2 дня<br>
+ Простейший рендер эффекта для прослушивания (без интерполяции и фильтров)<br>
+ Минимальные возможности редактирования (только мышь)<br>
+ Минимальные возможности импорта из WAV-файлов (только громкость)<br>
- Множество планируемых возможностей
</p><br><br>


<p id=txt class=lfx><a href=#conte title="К содержанию"><b>^</b></a> <a name=thank><b>Благодарности</b></a></p>
<p id=txt class=lfx>
Автор выражает благодарность следующим людям:<br><br>
<i>Alone Coder</i>, за соучастие в проекте;<br>
<i>Sergey Bulba</i>, за AY-Emulator, Vortex Tracker, различную документацию на сайте;<br>
<i>SMT</i>, за UnrealSpeccy и плеер VTX с открытыми исходниками;<br>
<i>Copper Feet</i>, за кросс-ассемблер asm80;<br>
А также авторам звуковых эффектов, вошедших в библиотеку.<br>
</p><br><br>


<p id=txt class=lfx><a href=#conte title="К содержанию"><b>^</b></a> <a name=conta><b>Контакты</b></a></p>
<p id=txt class=lfx>
Сообщения об ошибках, предложения и пожелания для новых версий, звуковые эффекты для включения в библиотеку принимаются по адресу <a href="mailto:shiru@mail.ru?subject=AY Sound FX Editor">shiru@mail.ru</a>
</p>
</body>
</html>